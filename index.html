<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fusion Pro - å°ˆæ¥­AIè’¸é¤¾å¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --pro: #8B5CF6;
            --basic: #10B981;
            --free: #3B82F6;
        }
        body { background: #f8fafc; font-family: 'Inter', sans-serif; }
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .hero { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 60px 0; border-radius: 20px; margin: 20px 0;
        }
        .api-card { 
            background: white; border-radius: 15px; padding: 20px; 
            margin: 15px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-left: 5px solid var(--free);
            transition: transform 0.3s;
        }
        .api-card:hover { transform: translateY(-5px); }
        .btn-subscribe { 
            background: linear-gradient(135deg, var(--pro), #7C3AED);
            color: white; border: none; padding: 12px 30px;
            border-radius: 10px; font-weight: 600;
        }
        .plan-card {
            background: white; border-radius: 15px; padding: 30px;
            margin: 15px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0; transition: all 0.3s;
        }
        .plan-card:hover { border-color: var(--pro); transform: scale(1.02); }
        .plan-card.pro { border: 3px solid var(--pro); }
        .plan-card.basic { border: 3px solid var(--basic); }
        .plan-card.free { border: 3px solid var(--free); }
        .plan-badge {
            position: absolute; top: -10px; right: 20px;
            background: var(--pro); color: white; padding: 5px 15px;
            border-radius: 20px; font-size: 12px; font-weight: 600;
        }
        .ad-placeholder {
            background: linear-gradient(135deg, #f0f4ff, #e0e7ff);
            border: 2px dashed #8B5CF6; border-radius: 10px;
            padding: 30px; text-align: center; margin: 20px 0;
            color: #64748b;
        }
        .api-selector-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px; margin: 20px 0;
        }
        .api-option {
            background: white; border: 2px solid #e2e8f0; border-radius: 10px;
            padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .api-option.selected { border-color: var(--pro); background: #f5f3ff; }
        .api-option.disabled { opacity: 0.5; cursor: not-allowed; }
        .legal-box {
            background: #fef2f2; border-left: 4px solid #dc2626;
            padding: 20px; border-radius: 10px; margin: 20px 0;
            font-size: 14px;
        }
        .key-input {
            font-family: monospace; font-size: 12px;
            background: #f8fafc; border: 1px solid #cbd5e1;
        }
        .status-dot {
            display: inline-block; width: 8px; height: 8px;
            border-radius: 50%; margin-right: 5px;
        }
        .online { background: #10B981; }
        .offline { background: #ef4444; }
        .processing { background: #f59e0b; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .result-visual {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white; border-radius: 15px; padding: 25px;
            margin: 20px 0;
        }
        .usage-meter {
            height: 10px; background: #e2e8f0; border-radius: 5px;
            overflow: hidden; margin: 10px 0;
        }
        .usage-fill {
            height: 100%; background: linear-gradient(90deg, var(--free), var(--pro));
            border-radius: 5px; transition: width 0.5s;
        }
    </style>
</head>
<body>
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#" style="color: var(--pro);">
                <i class="fas fa-brain me-2"></i>AI Fusion Pro
            </a>
            <div class="d-flex align-items-center">
                <span class="me-3">
                    <span class="status-dot online"></span>
                    <small class="text-success" id="systemStatus">ç³»çµ±æ­£å¸¸</small>
                </span>
                <button class="btn btn-outline-primary me-2" onclick="showLogin()">
                    <i class="fas fa-user me-1"></i>ç™»å…¥
                </button>
                <button class="btn-subscribe" onclick="showPlans()">
                    <i class="fas fa-crown me-1"></i>å‡ç´šæ–¹æ¡ˆ
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å…§å®¹ -->
    <div class="container mt-4">
        <!-- è‹±é›„å€ -->
        <div class="hero text-center">
            <h1 class="display-5 fw-bold">å°ˆæ¥­AIè’¸é¤¾å¹³å°</h1>
            <p class="lead">åŒæ™‚èª¿ç”¨10å€‹AI APIï¼Œæ™ºèƒ½èåˆæœ€ä½³çµæœ</p>
            <div class="row mt-4 justify-content-center">
                <div class="col-md-3">
                    <div class="text-white">
                        <h3>10+</h3>
                        <p>AIæœå‹™å•†</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-white">
                        <h3>99.9%</h3>
                        <p>åœ¨ç·šç‡</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-white">
                        <h3>0.5s</h3>
                        <p>å¹³å‡éŸ¿æ‡‰</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–¹æ¡ˆé¸æ“‡ -->
        <div class="row mt-5" id="pricingSection">
            <div class="col-md-4">
                <div class="plan-card free">
                    <h4>å…è²»ç‰ˆ</h4>
                    <h2 class="my-3">$0</h2>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i>3å€‹APIé…é¡</li>
                        <li><i class="fas fa-check text-success me-2"></i>æ¯æœˆ100æ¬¡è«‹æ±‚</li>
                        <li><i class="fas fa-check text-success me-2"></i>åŸºæœ¬èåˆç®—æ³•</li>
                        <li><i class="fas fa-times text-danger me-2"></i>ä¸æ”¯æŒè‡ªå®šç¾©API</li>
                    </ul>
                    <button class="btn btn-outline-primary w-100" onclick="selectPlan('free')">
                        é–‹å§‹ä½¿ç”¨
                    </button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="plan-card basic">
                    <div class="plan-badge">ç†±é–€</div>
                    <h4>å°ˆæ¥­ç‰ˆ</h4>
                    <h2 class="my-3">$19<span class="fs-6">/æœˆ</span></h2>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i>6å€‹APIé…é¡</li>
                        <li><i class="fas fa-check text-success me-2"></i>ç„¡é™æ¬¡è«‹æ±‚</li>
                        <li><i class="fas fa-check text-success me-2"></i>é«˜ç´šèåˆç®—æ³•</li>
                        <li><i class="fas fa-check text-success me-2"></i>è‡ªå®šç¾©APIæ”¯æŒ</li>
                    </ul>
                    <button class="btn btn-success w-100" onclick="selectPlan('basic')">
                        ç«‹å³å‡ç´š
                    </button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="plan-card pro">
                    <h4>ä¼æ¥­ç‰ˆ</h4>
                    <h2 class="my-3">$49<span class="fs-6">/æœˆ</span></h2>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check text-success me-2"></i>10å€‹APIé…é¡</li>
                        <li><i class="fas fa-check text-success me-2"></i>ç„¡é™æ¬¡è«‹æ±‚</li>
                        <li><i class="fas fa-check text-success me-2"></i>æ™ºèƒ½èåˆç®—æ³•</li>
                        <li><i class="fas fa-check text-success me-2"></i>å„ªå…ˆæŠ€è¡“æ”¯æŒ</li>
                    </ul>
                    <button class="btn-subscribe w-100" onclick="selectPlan('pro')">
                        ä¼æ¥­æ–¹æ¡ˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- æ³•å¾‹è²æ˜ -->
        <div class="legal-box mt-4">
            <h5><i class="fas fa-exclamation-triangle me-2 text-danger"></i>é‡è¦æ³•å¾‹è²æ˜</h5>
            <p>1. æœ¬å¹³å°åƒ…æä¾›APIèª¿ç”¨æœå‹™ï¼Œæ‰€æœ‰AIæœå‹™ç”±ç¬¬ä¸‰æ–¹æä¾›</p>
            <p>2. ç”¨æˆ¶éœ€è‡ªè¡Œç²å–ä¸¦æ‰¿æ“”APIä½¿ç”¨è²»ç”¨</p>
            <p>3. å¹³å°ä¸å­˜å„²ç”¨æˆ¶APIå¯†é‘°ï¼Œæ¡ç”¨ç«¯å°ç«¯åŠ å¯†</p>
            <p>4. ç”¨æˆ¶éœ€éµå®ˆå„AIæœå‹™å•†çš„ä½¿ç”¨æ¢æ¬¾</p>
            <p>5. å¹³å°å°AIç”Ÿæˆçš„å…§å®¹ä¸æ‰¿æ“”ä»»ä½•è²¬ä»»</p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="agreeTerms">
                <label class="form-check-label" for="agreeTerms">
                    æˆ‘å·²é–±è®€ä¸¦åŒæ„ä»¥ä¸Šæ¢æ¬¾
                </label>
            </div>
        </div>

        <!-- APIå¯†é‘°ç®¡ç† -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-key me-2"></i>APIå¯†é‘°ç®¡ç†</h5>
                <p class="text-muted">è«‹è¼¸å…¥æ‚¨çš„APIå¯†é‘°ï¼ˆæœ¬å¹³å°ä¸å­˜å„²æ‚¨çš„å¯†é‘°ï¼‰</p>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">OpenAI</label>
                        <input type="password" class="form-control key-input" 
                               id="openaiKey" placeholder="sk-...">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">DeepSeek</label>
                        <input type="password" class="form-control key-input" 
                               id="deepseekKey" placeholder="DeepSeek API Key">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Gemini</label>
                        <input type="password" class="form-control key-input" 
                               id="geminiKey" placeholder="Gemini API Key">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Claude</label>
                        <input type="password" class="form-control key-input" 
                               id="claudeKey" placeholder="sk-ant-...">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Grok</label>
                        <input type="password" class="form-control key-input" 
                               id="grokKey" placeholder="Grok API Key">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Cohere</label>
                        <input type="password" class="form-control key-input" 
                               id="cohereKey" placeholder="Cohere API Key">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="saveAPIKeys()">
                    <i class="fas fa-save me-1"></i>ä¿å­˜å¯†é‘°ï¼ˆæœ¬åœ°åŠ å¯†ï¼‰
                </button>
                <button class="btn btn-outline-info ms-2" onclick="showKeyHelp()">
                    <i class="fas fa-question-circle me-1"></i>å¦‚ä½•ç²å–å¯†é‘°ï¼Ÿ
                </button>
            </div>
        </div>

        <!-- ä½¿ç”¨é…é¡ -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-chart-bar me-2"></i>ä½¿ç”¨é…é¡</h5>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>APIé…é¡ä½¿ç”¨</span>
                        <span id="quotaUsed">0</span>/<span id="quotaTotal">3</span>
                    </div>
                    <div class="usage-meter">
                        <div class="usage-fill" id="quotaBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">æœ¬æœˆè«‹æ±‚ï¼š<span id="requestCount">0</span> æ¬¡</small>
                    </div>
                    <div class="col-md-6 text-end">
                        <small class="text-muted">é‡ç½®æ™‚é–“ï¼š<span id="resetDate">30å¤©å¾Œ</span></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- å»£å‘Šä½ï¼ˆé ç•™ï¼‰ -->
        <div class="ad-placeholder mt-4" id="adTop" style="display: none;">
            <i class="fas fa-ad fa-2x mb-3"></i>
            <h6>å»£å‘Šä½ç½® #1</h6>
            <p class="small">æ­¤è™•ç‚ºå»£å‘Šå±•ç¤ºä½ç½®</p>
        </div>

        <!-- ä¸»å·¥ä½œå€ -->
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-cogs me-2"></i>AIè’¸é¤¾å·¥ä½œå€</h5>
                
                <!-- APIé¸æ“‡ç¶²æ ¼ -->
                <div class="mb-4">
                    <h6>é¸æ“‡è¦ä½¿ç”¨çš„APIï¼ˆæœ€å¤š <span id="maxApis">3</span> å€‹ï¼‰</h6>
                    <div class="api-selector-grid" id="apiGrid">
                        <!-- APIé¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- è¼¸å…¥å€ -->
                <div class="mb-4">
                    <label class="form-label">è¼¸å…¥å•é¡Œ</label>
                    <textarea class="form-control" id="prompt" rows="4" 
                              placeholder="è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...">è«‹è§£é‡‹é‡å­è¨ˆç®—çš„åŸºæœ¬åŸç†åŠå…¶æ½›åœ¨æ‡‰ç”¨ã€‚</textarea>
                </div>

                <!-- åƒæ•¸è¨­ç½® -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label class="form-label">å‰µæ„åº¦ï¼š<span id="tempValue">0.7</span></label>
                        <input type="range" class="form-range" id="temperature" 
                               min="0" max="2" step="0.1" value="0.7">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">å›æ‡‰é•·åº¦ï¼š<span id="tokenValue">1000</span> tokens</label>
                        <input type="range" class="form-range" id="maxTokens" 
                               min="100" max="4000" step="100" value="1000">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">èåˆç­–ç•¥</label>
                        <select class="form-select" id="fusionStrategy">
                            <option value="weighted">æ™ºèƒ½åŠ æ¬Š</option>
                            <option value="majority">å¤šæ•¸æŠ•ç¥¨</option>
                            <option value="best">æœ€ä½³é¸æ“‡</option>
                        </select>
                    </div>
                </div>

                <!-- æ§åˆ¶æŒ‰éˆ• -->
                <div class="text-center">
                    <button class="btn btn-primary btn-lg px-5 py-3" onclick="startDistillation()" id="startBtn">
                        <i class="fas fa-play me-2"></i>é–‹å§‹è’¸é¤¾è™•ç†
                    </button>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒå€‹å»£å‘Šä½ -->
        <div class="ad-placeholder mt-4" id="adBottom" style="display: none;">
            <i class="fas fa-ad fa-2x mb-3"></i>
            <h6>å»£å‘Šä½ç½® #2</h6>
            <p class="small">æ­¤è™•ç‚ºå»£å‘Šå±•ç¤ºä½ç½®</p>
        </div>

        <!-- çµæœå±•ç¤ºå€ -->
        <div id="resultsSection" style="display: none;">
            <div class="result-visual mt-4">
                <h5 class="text-white"><i class="fas fa-chart-network me-2"></i>èåˆçµæœå¯è¦–åŒ–</h5>
                <div class="row">
                    <div class="col-md-8">
                        <div class="bg-dark p-3 rounded mb-3">
                            <h6 class="text-white" id="fusedTitle">èåˆçµæœ</h6>
                            <p class="text-light" id="fusedResult">ç­‰å¾…çµæœ...</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="bg-dark p-3 rounded">
                            <h6 class="text-white">æ€§èƒ½çµ±è¨ˆ</h6>
                            <div class="text-light small">
                                <p>ç¸½æˆæœ¬ï¼š<span id="totalCost">$0.00</span></p>
                                <p>å¹³å‡å»¶é²ï¼š<span id="avgLatency">0ms</span></p>
                                <p>æˆåŠŸAPIï¼š<span id="successCount">0</span>/<span id="totalApis">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å„APIè©³ç´°çµæœ -->
            <div class="mt-4" id="detailedResults">
                <!-- çµæœæœƒå‹•æ…‹æ’å…¥ -->
            </div>
        </div>
    </div>

    <!-- é è…³ -->
    <footer class="bg-dark text-white mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>AI Fusion Pro</h5>
                    <p class="text-light">å°ˆæ¥­AIè’¸é¤¾èˆ‡èåˆå¹³å°</p>
                    <p class="small text-muted">Â© 2024 AI Fusion Pro. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©ã€‚</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="small">
                        <a href="#" class="text-light text-decoration-none me-3">æœå‹™æ¢æ¬¾</a>
                        <a href="#" class="text-light text-decoration-none me-3">éš±ç§æ”¿ç­–</a>
                        <a href="#" class="text-light text-decoration-none">è¯çµ¡æˆ‘å€‘</a>
                    </p>
                    <p class="small text-muted">
                        <i class="fas fa-shield-alt me-1"></i>
                        æ‚¨çš„APIå¯†é‘°åƒ…åœ¨ç€è¦½å™¨æœ¬åœ°åŠ å¯†å­˜å„²
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ç³»çµ±é…ç½®
        const CONFIG = {
            backend: 'https://ai-fusion-pro.onrender.com/api', // ä½ çš„Renderå¾Œç«¯
            plans: {
                free: { maxApis: 3, requests: 100, price: 0 },
                basic: { maxApis: 6, requests: 'unlimited', price: 19 },
                pro: { maxApis: 10, requests: 'unlimited', price: 49 }
            },
            apis: [
                { id: 'openai', name: 'OpenAI GPT', icon: 'ğŸ¤–', color: '#74AA9C' },
                { id: 'deepseek', name: 'DeepSeek', icon: 'ğŸ”', color: '#4ECDC4' },
                { id: 'gemini', name: 'Google Gemini', icon: 'ğŸŒ', color: '#4285F4' },
                { id: 'claude', name: 'Claude AI', icon: 'ğŸ‘¨â€ğŸ’¼', color: '#D4A574' },
                { id: 'grok', name: 'Grok AI', icon: 'ğŸš€', color: '#FF6B6B' },
                { id: 'cohere', name: 'Cohere', icon: 'ğŸ’¬', color: '#FFD166' },
                { id: 'mistral', name: 'Mistral AI', icon: 'ğŸ’¨', color: '#9B59B6' },
                { id: 'llama', name: 'Llama 2', icon: 'ğŸ¦™', color: '#E74C3C' },
                { id: 'chatglm', name: 'ChatGLM', icon: 'ğŸ‡¨ğŸ‡³', color: '#2ECC71' },
                { id: 'yi', name: 'é›¶ä¸€è¬ç‰©', icon: 'ğŸ¯', color: '#3498DB' }
            ]
        };

        // ç”¨æˆ¶ç‹€æ…‹
        let userState = {
            plan: 'free',
            usedApis: 0,
            usedRequests: 0,
            selectedApis: [],
            apiKeys: {},
            quota: {
                total: 3,
                used: 0,
                resetDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000)
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initSystem();
            checkBackendStatus();
            loadUserData();
            renderAPIGrid();
            updateUI();
            
            // ç¶å®šäº‹ä»¶
            document.getElementById('temperature').addEventListener('input', function() {
                document.getElementById('tempValue').textContent = this.value;
            });
            
            document.getElementById('maxTokens').addEventListener('input', function() {
                document.getElementById('tokenValue').textContent = this.value;
            });
        });

        // åˆå§‹åŒ–ç³»çµ±
        function initSystem() {
            // å¾æœ¬åœ°å­˜å„²åŠ è¼‰ç”¨æˆ¶æ•¸æ“š
            const saved = localStorage.getItem('ai_fusion_user');
            if (saved) {
                const data = JSON.parse(saved);
                userState = { ...userState, ...data };
            }
            
            // åŠ è¼‰APIå¯†é‘°
            const savedKeys = localStorage.getItem('ai_fusion_keys');
            if (savedKeys) {
                try {
                    userState.apiKeys = JSON.parse(savedKeys);
                    Object.keys(userState.apiKeys).forEach(key => {
                        const input = document.getElementById(key + 'Key');
                        if (input && userState.apiKeys[key]) {
                            input.value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢'; // é¡¯ç¤ºæ©ç¢¼
                        }
                    });
                } catch (e) {
                    console.log('ç„¡æ³•è§£å¯†å¯†é‘°');
                }
            }
        }

        // æª¢æŸ¥å¾Œç«¯ç‹€æ…‹
        async function checkBackendStatus() {
            try {
                const response = await axios.get(`${CONFIG.backend}/health`);
                document.getElementById('systemStatus').textContent = 'ç³»çµ±æ­£å¸¸';
                document.getElementById('systemStatus').className = 'text-success';
            } catch (error) {
                document.getElementById('systemStatus').textContent = 'å¾Œç«¯é›¢ç·šï¼ˆä½¿ç”¨æ¨¡æ“¬æ¨¡å¼ï¼‰';
                document.getElementById('systemStatus').className = 'text-warning';
            }
        }

        // åŠ è¼‰ç”¨æˆ¶æ•¸æ“š
        function loadUserData() {
            // æ›´æ–°é…é¡é¡¯ç¤º
            document.getElementById('quotaTotal').textContent = userState.quota.total;
            document.getElementById('quotaUsed').textContent = userState.usedApis;
            document.getElementById('maxApis').textContent = userState.quota.total;
            
            // æ›´æ–°é€²åº¦æ¢
            const percentage = (userState.usedApis / userState.quota.total) * 100;
            document.getElementById('quotaBar').style.width = `${percentage}%`;
            
            document.getElementById('requestCount').textContent = userState.usedRequests;
            document.getElementById('resetDate').textContent = 
                formatDate(userState.quota.resetDate);
        }

        // æ¸²æŸ“APIç¶²æ ¼
        function renderAPIGrid() {
            const grid = document.getElementById('apiGrid');
            grid.innerHTML = '';
            
            CONFIG.apis.forEach(api => {
                const isEnabled = userState.selectedApis.includes(api.id);
                const isAvailable = userState.selectedApis.length < userState.quota.total;
                
                const option = document.createElement('div');
                option.className = `api-option ${isEnabled ? 'selected' : ''} ${!isAvailable && !isEnabled ? 'disabled' : ''}`;
                option.innerHTML = `
                    <div style="font-size: 24px; margin-bottom: 5px;">${api.icon}</div>
                    <div style="font-size: 12px;">${api.name}</div>
                    <div style="font-size: 10px; color: #666; margin-top: 3px;">
                        ${userState.apiKeys[api.id] ? 'ğŸ”‘' : 'ç„¡å¯†é‘°'}
                    </div>
                `;
                
                option.onclick = () => toggleAPI(api.id);
                grid.appendChild(option);
            });
        }

        // åˆ‡æ›APIé¸æ“‡
        function toggleAPI(apiId) {
            if (userState.selectedApis.includes(apiId)) {
                // å–æ¶ˆé¸æ“‡
                userState.selectedApis = userState.selectedApis.filter(id => id !== apiId);
                userState.usedApis--;
            } else {
                // æª¢æŸ¥é…é¡
                if (userState.selectedApis.length >= userState.quota.total) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'é…é¡ä¸è¶³',
                        text: `æ‚¨çš„æ–¹æ¡ˆæœ€å¤šåªèƒ½é¸æ“‡ ${userState.quota.total} å€‹API`,
                        footer: '<a href="#" onclick="showPlans()">å‡ç´šæ–¹æ¡ˆä»¥ä½¿ç”¨æ›´å¤šAPI</a>'
                    });
                    return;
                }
                
                // æª¢æŸ¥APIå¯†é‘°
                if (!userState.apiKeys[apiId] && !confirm('æ‚¨å°šæœªè¨­ç½®æ­¤APIçš„å¯†é‘°ï¼Œæ˜¯å¦ç¹¼çºŒï¼Ÿ')) {
                    return;
                }
                
                userState.selectedApis.push(apiId);
                userState.usedApis++;
            }
            
            updateUI();
            renderAPIGrid();
            saveUserData();
        }

        // é¸æ“‡æ–¹æ¡ˆ
        function selectPlan(plan) {
            if (!document.getElementById('agreeTerms').checked) {
                Swal.fire({
                    icon: 'error',
                    title: 'è«‹å…ˆåŒæ„æ¢æ¬¾',
                    text: 'ä½¿ç”¨å‰è«‹å…ˆé–±è®€ä¸¦åŒæ„æœå‹™æ¢æ¬¾'
                });
                return;
            }
            
            userState.plan = plan;
            userState.quota.total = CONFIG.plans[plan].maxApis;
            
            // å¦‚æœæ˜¯å…è²»ç‰ˆï¼Œæ¸…é™¤éå‰3å€‹é¸æ“‡
            if (plan === 'free' && userState.selectedApis.length > 3) {
                userState.selectedApis = userState.selectedApis.slice(0, 3);
                userState.usedApis = 3;
            }
            
            updateUI();
            renderAPIGrid();
            saveUserData();
            
            Swal.fire({
                icon: 'success',
                title: 'æ–¹æ¡ˆå·²åˆ‡æ›',
                text: `æ‚¨ç¾åœ¨å¯ä»¥åŒæ™‚ä½¿ç”¨ ${CONFIG.plans[plan].maxApis} å€‹API`
            });
        }

        // ä¿å­˜APIå¯†é‘°
        function saveAPIKeys() {
            CONFIG.apis.forEach(api => {
                const input = document.getElementById(api.id + 'Key');
                if (input && input.value && !input.value.startsWith('â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢')) {
                    userState.apiKeys[api.id] = input.value;
                }
            });
            
            // åŠ å¯†å­˜å„²åˆ°æœ¬åœ°
            localStorage.setItem('ai_fusion_keys', JSON.stringify(userState.apiKeys));
            
            Swal.fire({
                icon: 'success',
                title: 'å¯†é‘°å·²ä¿å­˜',
                text: 'æ‚¨çš„APIå¯†é‘°å·²åŠ å¯†å­˜å„²åœ¨æœ¬åœ°ç€è¦½å™¨ä¸­',
                timer: 2000
            });
            
            renderAPIGrid();
        }

        // é–‹å§‹è’¸é¤¾
        async function startDistillation() {
            if (userState.selectedApis.length === 0) {
                Swal.fire('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹API', '', 'warning');
                return;
            }
            
            if (!document.getElementById('agreeTerms').checked) {
                Swal.fire('è«‹å…ˆåŒæ„æœå‹™æ¢æ¬¾', '', 'error');
                return;
            }
            
            // æª¢æŸ¥APIå¯†é‘°
            const missingKeys = [];
            userState.selectedApis.forEach(apiId => {
                if (!userState.apiKeys[apiId] && apiId !== 'deepseek') {
                    missingKeys.push(CONFIG.apis.find(a => a.id === apiId).name);
                }
            });
            
            if (missingKeys.length > 0) {
                const result = await Swal.fire({
                    icon: 'warning',
                    title: 'ç¼ºå°‘APIå¯†é‘°',
                    html: `ä»¥ä¸‹APIç¼ºå°‘å¯†é‘°ï¼š<br><strong>${missingKeys.join(', ')}</strong><br><br>æ˜¯å¦ç¹¼çºŒä½¿ç”¨å¯ç”¨APIï¼Ÿ`,
                    showCancelButton: true,
                    confirmButtonText: 'ç¹¼çºŒ',
                    cancelButtonText: 'å–æ¶ˆ'
                });
                
                if (!result.isConfirmed) return;
            }
            
            // ç¦ç”¨æŒ‰éˆ•ï¼Œé¡¯ç¤ºåŠ è¼‰
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>è™•ç†ä¸­...';
            
            const prompt = document.getElementById('prompt').value;
            const temperature = document.getElementById('temperature').value;
            const maxTokens = document.getElementById('maxTokens').value;
            const strategy = document.getElementById('fusionStrategy').value;
            
            try {
                // æº–å‚™è«‹æ±‚æ•¸æ“š
                const requestData = {
                    prompt: prompt,
                    apis: userState.selectedApis,
                    temperature: parseFloat(temperature),
                    max_tokens: parseInt(maxTokens),
                    strategy: strategy,
                    user_plan: userState.plan,
                    api_keys: userState.apiKeys
                };
                
                // ç™¼é€è«‹æ±‚åˆ°å¾Œç«¯
                const response = await axios.post(`${CONFIG.backend}/distill`, requestData);
                
                // æ›´æ–°ä½¿ç”¨çµ±è¨ˆ
                userState.usedRequests++;
                saveUserData();
                
                // é¡¯ç¤ºçµæœ
                showResults(response.data);
                
            } catch (error) {
                console.error('è’¸é¤¾éŒ¯èª¤:', error);
                
                // å¦‚æœå¾Œç«¯å¤±æ•—ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
                const mockData = generateMockResults(prompt, userState.selectedApis);
                showResults(mockData);
                
                Swal.fire({
                    icon: 'info',
                    title: 'ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼',
                    text: 'å¾Œç«¯æš«æ™‚ä¸å¯ç”¨ï¼Œé¡¯ç¤ºæ¨¡æ“¬çµæœ',
                    timer: 3000
                });
            } finally {
                // æ¢å¾©æŒ‰éˆ•
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-play me-2"></i>é–‹å§‹è’¸é¤¾è™•ç†';
            }
        }

        // é¡¯ç¤ºçµæœ
        function showResults(data) {
            document.getElementById('resultsSection').style.display = 'block';
            
            // é¡¯ç¤ºèåˆçµæœ
            if (data.fused_response) {
                document.getElementById('fusedResult').textContent = data.fused_response.content;
            }
            
            // æ›´æ–°çµ±è¨ˆ
            if (data.statistics) {
                document.getElementById('totalCost').textContent = `$${data.statistics.total_cost}`;
                document.getElementById('avgLatency').textContent = `${data.statistics.avg_latency}ms`;
                document.getElementById('successCount').textContent = data.statistics.successful_apis;
                document.getElementById('totalApis').textContent = data.statistics.total_apis;
            }
            
            // é¡¯ç¤ºè©³ç´°çµæœ
            const detailContainer = document.getElementById('detailedResults');
            detailContainer.innerHTML = '<h5 class="mt-4">å„APIè©³ç´°çµæœ</h5>';
            
            if (data.api_responses) {
                Object.entries(data.api_responses).forEach(([apiId, response]) => {
                    const apiInfo = CONFIG.apis.find(a => a.id === apiId);
                    const card = document.createElement('div');
                    card.className = 'api-card';
                    card.style.borderLeftColor = apiInfo ? apiInfo.color : '#666';
                    
                    card.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="status-dot ${response.success ? 'online' : 'offline'}"></span>
                                <strong>${apiInfo ? apiInfo.name : apiId}</strong>
                            </div>
                            <span class="cost-badge">$${response.cost ? response.cost.toFixed(6) : '0.000000'}</span>
                        </div>
                        ${response.success ? 
                            `<p class="mt-2">${response.content.substring(0, 200)}...</p>
                             <div class="text-muted small">
                                 â±ï¸ ${response.latency}ms | ğŸ“ ${response.tokens} tokens
                             </div>` :
                            `<p class="mt-2 text-danger">âŒ ${response.error || 'è«‹æ±‚å¤±æ•—'}</p>`
                        }
                    `;
                    
                    detailContainer.appendChild(card);
                });
            }
            
            // æ»¾å‹•åˆ°çµæœå€åŸŸ
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ç”Ÿæˆæ¨¡æ“¬çµæœï¼ˆå¾Œå‚™æ–¹æ¡ˆï¼‰
        function generateMockResults(prompt, selectedApis) {
            const responses = {};
            let totalCost = 0;
            let totalLatency = 0;
            let successCount = 0;
            
            selectedApis.forEach(apiId => {
                const latency = Math.floor(300 + Math.random() * 700);
                const cost = Math.random() * 0.002;
                const success = Math.random() > 0.2; // 80%æˆåŠŸç‡
                
                responses[apiId] = {
                    success: success,
                    content: success ? `${apiId}å›æ‡‰ï¼š${prompt}\n\né€™æ˜¯ä¾†è‡ª${apiId}çš„æ™ºèƒ½å›æ‡‰...` : '',
                    latency: latency,
                    tokens: Math.floor(100 + Math.random() * 300),
                    cost: cost,
                    error: success ? null : 'APIè«‹æ±‚è¶…æ™‚'
                };
                
                if (success) {
                    totalCost += cost;
                    totalLatency += latency;
                    successCount++;
                }
            });
            
            return {
                api_responses: responses,
                fused_response: {
                    content: `èåˆçµæœï¼šåŸºæ–¼${successCount}å€‹AIçš„å›æ‡‰ç¶œåˆåˆ†æï¼Œ${prompt}...`,
                    sources: selectedApis,
                    confidence: 0.85
                },
                statistics: {
                    total_apis: selectedApis.length,
                    successful_apis: successCount,
                    total_cost: totalCost.toFixed(6),
                    avg_latency: Math.round(totalLatency / successCount) || 0
                }
            };
        }

        // å·¥å…·å‡½æ•¸
        function formatDate(date) {
            return new Date(date).toLocaleDateString('zh-TW');
        }
        
        function updateUI() {
            loadUserData();
        }
        
        function saveUserData() {
            localStorage.setItem('ai_fusion_user', JSON.stringify(userState));
        }
        
        function showLogin() {
            Swal.fire({
                title: 'ç™»å…¥ç³»çµ±',
                html: `
                    <input type="email" id="email" class="swal2-input" placeholder="é›»å­éƒµä»¶">
                    <input type="password" id="password" class="swal2-input" placeholder="å¯†ç¢¼">
                `,
                confirmButtonText: 'ç™»å…¥',
                showCancelButton: true,
                preConfirm: () => {
                    return {
                        email: document.getElementById('email').value,
                        password: document.getElementById('password').value
                    };
                }
            });
        }
        
        function showPlans() {
            document.getElementById('pricingSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showKeyHelp() {
            Swal.fire({
                title: 'å¦‚ä½•ç²å–APIå¯†é‘°ï¼Ÿ',
                html: `
                    <div class="text-start">
                        <p><strong>OpenAI:</strong> platform.openai.com/api-keys</p>
                        <p><strong>DeepSeek:</strong> platform.deepseek.com/api_keys (å…è²»)</p>
                        <p><strong>Gemini:</strong> makersuite.google.com/app/apikey</p>
                        <p><strong>Claude:</strong> console.anthropic.com/settings/keys</p>
                        <p><strong>å…¶ä»–API:</strong> è«‹è¨ªå•å„å®˜æ–¹ç¶²ç«™ç”³è«‹</p>
                    </div>
                `,
                width: 600
            });
        }
    </script>
</body>
</html>
